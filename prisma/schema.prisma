generator client {
  provider   = "prisma-client-js"
  output     = "./generated/client"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
}

model User {
  uid              String            @id
  email            String            @unique
  displayName      String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  avatarURL        String?
  careerChallenges CareerChallenge[]
  saves            Save[]

  @@index([email])
  @@index([createdAt])
}

model Save {
  id              String            @id
  userId          String
  gameId          String
  countryCode     String?
  currentClubId   Int?
  currentNTId     Int?
  currentLeagueId Int?
  season          String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  challenges      CareerChallenge[]
  careerStints    CareerStint[]
  currentClub     Team?             @relation("SaveCurrentClub", fields: [currentClubId], references: [id])
  currentLeague   CompetitionGroup? @relation(fields: [currentLeagueId], references: [id])
  currentNT       Team?             @relation("SaveCurrentNT", fields: [currentNTId], references: [id])
  game            Game              @relation(fields: [gameId], references: [id])
  user            User              @relation(fields: [userId], references: [uid], onDelete: Cascade)
  seasons         Season[]
  trophies        Trophy[]

  @@index([userId])
  @@index([gameId])
  @@index([season])
  @@index([createdAt])
}

model CareerStint {
  id         Int      @id @default(autoincrement())
  saveId     String
  teamId     Int
  startDate  String
  endDate    String?
  isNational Boolean
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  save       Save     @relation(fields: [saveId], references: [id], onDelete: Cascade)
  team       Team     @relation(fields: [teamId], references: [id])

  @@index([saveId])
  @@index([teamId])
  @@index([startDate])
}

model Season {
  id           Int           @id @default(autoincrement())
  saveId       String
  season       String
  teamId       Int
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  cupResults   CupResult[]
  leagueResult LeagueResult?
  save         Save          @relation(fields: [saveId], references: [id], onDelete: Cascade)
  team         Team          @relation(fields: [teamId], references: [id])

  @@index([saveId])
  @@index([teamId])
  @@index([season])
}

model CupResult {
  id            Int              @id @default(autoincrement())
  seasonId      Int
  competitionId Int
  reachedRound  String
  createdAt     DateTime         @default(now())
  competition   CompetitionGroup @relation("CupResults", fields: [competitionId], references: [id])
  season        Season           @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@index([seasonId])
  @@index([competitionId])
}

model LeagueResult {
  id            Int              @id @default(autoincrement())
  seasonId      Int              @unique
  competitionId Int
  position      Int
  promoted      Boolean
  relegated     Boolean
  createdAt     DateTime         @default(now())
  competition   CompetitionGroup @relation("LeagueResults", fields: [competitionId], references: [id])
  season        Season           @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@index([competitionId])
  @@index([position])
}

model Trophy {
  id                 Int              @id @default(autoincrement())
  teamId             Int
  competitionGroupId Int
  season             String
  gameId             String
  createdAt          DateTime         @default(now())
  saveId             String?
  competitionGroup   CompetitionGroup @relation(fields: [competitionGroupId], references: [id])
  game               Game             @relation(fields: [gameId], references: [id])
  save               Save?            @relation(fields: [saveId], references: [id], onDelete: Cascade)
  team               Team             @relation(fields: [teamId], references: [id])

  @@index([teamId])
  @@index([competitionGroupId])
  @@index([gameId])
  @@index([saveId])
  @@index([season])
}

model Challenge {
  id               Int               @id @default(autoincrement())
  name             String            @unique
  description      String
  bonus            String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  careerChallenges CareerChallenge[]
  goals            ChallengeGoal[]

  @@index([name])
}

model ChallengeGoal {
  id                   Int                   @id @default(autoincrement())
  description          String
  competitionId        Int?
  countryId            String?
  challengeId          Int
  careerChallengeGoals CareerChallengeGoal[]
  challenge            Challenge             @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  competition          CompetitionGroup?     @relation(fields: [competitionId], references: [id])
  country              Country?              @relation(fields: [countryId], references: [code])
  teams                ChallengeGoalTeam[]

  @@index([challengeId])
  @@index([competitionId])
  @@index([countryId])
}

model ChallengeGoalTeam {
  id              Int           @id @default(autoincrement())
  challengeGoalId Int
  teamId          Int
  challengeGoal   ChallengeGoal @relation(fields: [challengeGoalId], references: [id], onDelete: Cascade)
  team            Team          @relation(fields: [teamId], references: [id])

  @@unique([challengeGoalId, teamId])
  @@index([challengeGoalId])
  @@index([teamId])
}

model CareerChallenge {
  id           Int                   @id @default(autoincrement())
  userId       String
  challengeId  Int
  startedAt    DateTime              @default(now())
  completedAt  DateTime?
  gameId       String
  saveId       String?
  challenge    Challenge             @relation(fields: [challengeId], references: [id])
  game         Game                  @relation(fields: [gameId], references: [id])
  save         Save?                 @relation(fields: [saveId], references: [id], onDelete: Cascade)
  user         User                  @relation(fields: [userId], references: [uid], onDelete: Cascade)
  goalProgress CareerChallengeGoal[]

  @@index([userId])
  @@index([challengeId])
  @@index([gameId])
  @@index([saveId])
}

model CareerChallengeGoal {
  id                Int             @id @default(autoincrement())
  careerChallengeId Int
  challengeGoalId   Int
  isComplete        Boolean         @default(false)
  completedAt       DateTime?
  createdAt         DateTime        @default(now())
  careerChallenge   CareerChallenge @relation(fields: [careerChallengeId], references: [id], onDelete: Cascade)
  challengeGoal     ChallengeGoal   @relation(fields: [challengeGoalId], references: [id], onDelete: Cascade)

  @@unique([careerChallengeId, challengeGoalId])
  @@index([careerChallengeId])
  @@index([challengeGoalId])
  @@index([isComplete])
}

model TeamSeason {
  id               Int            @id @default(autoincrement())
  teamId           Int
  apiCompetitionId Int
  season           String
  createdAt        DateTime       @default(now())
  apiCompetition   ApiCompetition @relation(fields: [apiCompetitionId], references: [id])
  team             Team           @relation(fields: [teamId], references: [id])

  @@unique([teamId, apiCompetitionId, season])
  @@index([teamId])
  @@index([apiCompetitionId])
  @@index([season])
}

model Game {
  id               String            @id
  name             String
  shortName        String
  version          String
  platform         String
  logoUrl          String
  releaseDate      DateTime
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  isActive         Boolean
  sortOrder        Int
  variant          String
  careerChallenges CareerChallenge[]
  saves            Save[]
  trophies         Trophy[]

  @@index([isActive])
  @@index([sortOrder])
  @@index([releaseDate])
}

model Team {
  id                 Int                 @id
  name               String
  logo               String
  national           Boolean
  countryCode        String
  lat                Float?
  lng                Float?
  isFemale           Boolean?
  careerStints       CareerStint[]
  challengeGoalTeams ChallengeGoalTeam[]
  currentClubSaves   Save[]              @relation("SaveCurrentClub")
  currentNTSaves     Save[]              @relation("SaveCurrentNT")
  seasons            Season[]
  country            Country             @relation(fields: [countryCode], references: [code])
  teamSeasons        TeamSeason[]
  trophies           Trophy[]
}

model Country {
  code              String             @id
  name              String
  flag              String
  inFootballManager Boolean
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  apiCompetitions   ApiCompetition[]
  challengeGoals    ChallengeGoal[]
  competitionGroups CompetitionGroup[]
  teams             Team[]

  @@index([name])
  @@index([inFootballManager])
}

model ApiCompetition {
  id          Int                              @id @default(autoincrement())
  name        String
  countryCode String
  type        String
  logoUrl     String?
  tier        Int?
  isActive    Boolean
  createdAt   DateTime                         @default(now())
  updatedAt   DateTime                         @updatedAt
  country     Country                          @relation(fields: [countryCode], references: [code])
  groups      CompetitionGroupApiCompetition[]
  teamSeasons TeamSeason[]

  @@index([countryCode])
  @@index([type])
  @@index([tier])
  @@index([isActive])
}

model CompetitionGroup {
  id              Int                              @id @default(autoincrement())
  name            String
  displayName     String
  countryCode     String
  type            String
  tier            Int?
  logoUrl         String?
  isActive        Boolean
  createdAt       DateTime                         @default(now())
  updatedAt       DateTime                         @updatedAt
  challengeGoals  ChallengeGoal[]
  country         Country                          @relation(fields: [countryCode], references: [code])
  apiCompetitions CompetitionGroupApiCompetition[]
  cupResults      CupResult[]                      @relation("CupResults")
  leagueResults   LeagueResult[]                   @relation("LeagueResults")
  promotionsFrom  PromotionRelegation[]            @relation("PromotionsFrom")
  promotionsTo    PromotionRelegation[]            @relation("PromotionsTo")
  saves           Save[]
  trophies        Trophy[]

  @@unique([name, countryCode])
  @@index([countryCode])
  @@index([type])
  @@index([tier])
  @@index([isActive])
  @@index([name])
}

model CompetitionGroupApiCompetition {
  id                 Int              @id @default(autoincrement())
  competitionGroupId Int
  apiCompetitionId   Int
  createdAt          DateTime         @default(now())
  apiCompetition     ApiCompetition   @relation(fields: [apiCompetitionId], references: [id], onDelete: Cascade)
  competitionGroup   CompetitionGroup @relation(fields: [competitionGroupId], references: [id], onDelete: Cascade)

  @@unique([competitionGroupId, apiCompetitionId])
  @@index([competitionGroupId])
  @@index([apiCompetitionId])
}

model PromotionRelegation {
  id           Int              @id @default(autoincrement())
  fromGroupId  Int
  toGroupId    Int
  type         String
  slots        Int
  playoffSlots Int?
  createdAt    DateTime         @default(now())
  fromGroup    CompetitionGroup @relation("PromotionsFrom", fields: [fromGroupId], references: [id], onDelete: Cascade)
  toGroup      CompetitionGroup @relation("PromotionsTo", fields: [toGroupId], references: [id], onDelete: Cascade)

  @@index([fromGroupId])
  @@index([toGroupId])
  @@index([type])
}
